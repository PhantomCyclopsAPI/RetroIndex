<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Snake · 经典贪吃蛇的现代重制 · 极简渐变、顺滑动画、支持深浅色主题"/>
  <title>Snake</title>

  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>

  <style>
    :root{
      --bg-0:#0f1c24; --bg-1:#324450; --tx-0:#d8e9f0; --tx-1:#b8c7d6;
      --pri-0:#00e0ff; --pri-1:#9caedb;
      --card-bg:rgba(10,20,28,.55);
      --card-shadow:0 12px 32px rgba(0,224,255,.14);
      --card-shadow-hover:0 16px 48px rgba(0,224,255,.22);
      --focus:0 0 0 3px rgba(0,224,255,.35);
      --rad-xl:24px; --rad-lg:16px;
    }
    body.dark-theme{
      --bg-0:#2a1400; --bg-1:#b64b00; --tx-0:#fff2e2; --tx-1:#ffe3c7;
      --pri-0:#ff7a00; --pri-1:#ffd28a;
      --card-bg:rgba(56,24,0,.55);
      --card-shadow:0 12px 32px rgba(255,122,0,.20);
      --card-shadow-hover:0 16px 48px rgba(255,122,0,.30);
      --focus:0 0 0 3px rgba(255,122,0,.4);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--tx-0);
      background:linear-gradient(180deg,var(--bg-0) 0%,var(--bg-1) 100%);
      overflow-x:hidden; transition:background .45s ease,color .45s ease; animation:fadeIn 1s ease both;
    }
    @keyframes fadeIn{from{opacity:.0}to{opacity:1}}
    a{color:inherit; text-decoration:none}
    button{font:inherit; cursor:pointer}

    /* 顶栏（只保留 Home / Snake / Gomoku） */
    nav{
      position:sticky; top:0; z-index:100; display:flex; gap:20px; justify-content:center; align-items:center;
      padding:16px 20px; transition:all .3s ease; background:transparent;
    }
    nav.scrolled{background:rgba(0,0,0,.25); backdrop-filter:blur(10px); padding:10px 20px}
    nav ul{display:flex; list-style:none; gap:24px; padding:0; margin:0}
    nav a{position:relative; font-weight:600; opacity:.95}
    nav a::after{content:''; position:absolute; left:0; bottom:-6px; height:2px; width:0;
      background:linear-gradient(90deg,var(--pri-0),var(--pri-1)); transition:width .25s ease;}
    nav a:hover::after, nav a[aria-current="page"]::after{width:100%}
    #theme-toggle{
      background:linear-gradient(135deg,var(--pri-0),var(--pri-1)); color:#0a1a22; border:none; border-radius:999px;
      padding:8px 14px; font-weight:700; transition:transform .25s ease, box-shadow .25s ease;
    }
    #theme-toggle:hover{transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.25)}
    #theme-toggle:focus-visible{outline:none; box-shadow:var(--focus)}

    .hero{text-align:center; padding:68px 20px 26px;}
    .hero h1{
      margin:0 0 8px; font-size:40px; font-weight:800; font-family:'Exo',sans-serif;
      background:linear-gradient(90deg,var(--pri-0),var(--pri-1));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .hero p{margin:0 auto; max-width:560px; color:var(--tx-1)}

    .game-grid{width:min(1100px,92vw); margin:0 auto; padding:32px 20px}
    .game-card{
      background:var(--card-bg); border-radius:var(--rad-xl); box-shadow:var(--card-shadow);
      padding:18px; text-align:center; transition:transform .35s ease, box-shadow .35s ease, opacity .6s ease-out;
      opacity:0; transform:translateY(24px); border:none; margin:0 auto; max-width:720px;
    }
    .game-card.visible{opacity:1; transform:translateY(0)}
    .game-card:hover{transform:translateY(-10px); box-shadow:var(--card-shadow-hover)}

    #game-canvas{margin:0 auto 16px; border-radius:var(--rad-lg); overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.25);
      width:100%; max-width:600px; aspect-ratio:1/1;}
    #game-canvas canvas{display:block; width:100% !important; height:auto !important}

    #hud{margin-bottom:12px; font-size:16px; font-weight:600; color:var(--tx-0)}
    #hud span{margin:0 12px}
    .game-card h2{font:700 22px 'Exo',sans-serif; margin:4px 0 6px}
    .game-card p{font-size:14px; color:var(--tx-1); margin:0 0 8px}

    .back-link{
      display:block; text-align:center; margin:0 auto 26px; width:fit-content;
      padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06);
    }

    @media (max-width:768px){
      .hero h1{font-size:32px}
      nav ul{gap:16px; flex-wrap:wrap; justify-content:center}
    }
    @media (prefers-reduced-motion:reduce){
      *,*:before,*:after{transition:none !important; animation:none !important}
      .game-card{opacity:1 !important; transform:none !important}
    }
  </style>
</head>
<body>
  <!-- 顶栏：仅 Home / Snake / Gomoku -->
  <nav role="navigation" aria-label="主导航">
    <ul>
      <li><a href="/index.html">Home</a></li>
      <li><a href="/Games/snake.html" aria-current="page">Snake</a></li>
      <li><a href="/Games/Gomoku.html">Gomoku</a></li>
    </ul>
    <button id="theme-toggle" aria-label="切换主题" aria-pressed="false">切换主题</button>
  </nav>

  <section class="hero" role="banner">
    <h1>Snake</h1>
    <p>极简块状像素与顺滑动画。方向键/WASD 控制，支持暂停与逐步提速。</p>
  </section>

  <div class="game-grid">
    <div class="game-card" style="--card-index:0">
      <div id="hud">
        <span>Score: <strong id="score">0</strong></span>
        <span>High Score: <strong id="high-score">0</strong></span>
      </div>
      <div id="game-canvas" aria-label="Snake 游戏画布容器"></div>
      <h2>Snake</h2>
      <p>Eat to grow. Avoid walls & yourself. Try special dots!</p>
    </div>
  </div>

  <a href="/index.html" class="back-link">← Back to Home</a>

  <script>
    /* 主题逻辑（持久化） */
    const THEME_KEY='retroIndexTheme';
    const applyTheme=(t)=>{
      const dark = t==='dark';
      document.body.classList.toggle('dark-theme', dark);
      document.getElementById('theme-toggle').setAttribute('aria-pressed', String(dark));
    };
    (()=>{
      const saved=localStorage.getItem(THEME_KEY);
      const prefersDark=window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(saved || (prefersDark?'dark':'light'));
    })();
    document.getElementById('theme-toggle').addEventListener('click',()=>{
      const dark=!document.body.classList.contains('dark-theme');
      applyTheme(dark?'dark':'light');
      localStorage.setItem(THEME_KEY, dark?'dark':'light');
    });

    // 顶栏滚动态
    let ticking=false;
    window.addEventListener('scroll',()=>{
      if(!ticking){
        requestAnimationFrame(()=>{
          const nav=document.querySelector('nav');
          if(window.scrollY>100) nav.classList.add('scrolled'); else nav.classList.remove('scrolled');
          ticking=false;
        }); ticking=true;
      }
    });

    // 卡片出现动画
    const io=new IntersectionObserver(es=>{
      es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); io.unobserve(e.target);} });
    },{threshold:.2});
    document.querySelectorAll('.game-card').forEach(c=>io.observe(c));

    /* Snake 游戏逻辑（与你现有版本一致并做主题适配与小修正） */
    const GRID_SIZE = 20, TILE_SIZE = 20, FPS_RENDER = 120;
    let movesPerSec = 5, MOVE_INTERVAL = 1000 / movesPerSec;

    const SPEED_INCREASE_PER_TWO_SCORES = 0.4;

    function themeColors(){
      const dark = document.body.classList.contains('dark-theme');
      return {
        CANVAS_BG: dark ? 0x1a0f00 : 255,
        BORDER_COLOR: dark ? 'rgba(255,210,138,0.25)' : '#dddddd',
        GRAD_START: dark ? '#ff7a00' : '#007aff',
        GRAD_END:   dark ? '#ffd28a' : '#d0e6ff',
        FOOD_COLOR: dark ? '#ffae5a' : '#FF5C00',
        SPEED_DOT_COLOR: dark ? '#ff7a00' : '#007aff',
        SHRINK_COLOR: dark ? '#ff7a00' : '#007aff',
        TEXT: dark ? '#ffffff' : '#000000'
      };
    }

    let flashStartTime = null, flashIsShrinkDot = false;
    const FLASH_DURATION = 300;

    let shrinkDot = null, speedDot = null;
    const SPEED_BOOST_DURATION = 5000;
    let speedBoostEndTime = null;

    let shrinkEffectStart = null;
    const SHRINK_EFFECT_DURATION = 500;

    let snake = [], prevSnake = [], food;
    let score = 0, highScore = +localStorage.getItem('snakeHighScore') || 0;
    let gameOver = false, direction = { x:1, y:0 }, lastMoveMs = 0, gameStarted = false, paused = false;
    let particles = [], scoreAnimations = [];

    function setup() {
      const cnv = createCanvas(GRID_SIZE*TILE_SIZE, GRID_SIZE*TILE_SIZE);
      cnv.parent('game-canvas');
      cnv.elt.setAttribute('tabindex','0');
      cnv.elt.focus();
      frameRate(FPS_RENDER);
      colorMode(RGB,255);
    }

    function setSnakeSpeed(s){ movesPerSec = constrain(s,1,9); MOVE_INTERVAL = 1000 / movesPerSec; }

    function startFreshGame(){
      snake=[{x:floor(GRID_SIZE/2), y:floor(GRID_SIZE/2)}];
      prevSnake = snake.map(s=>({...s}));
      direction={x:1,y:0}; score=0; setSnakeSpeed(5);
      gameOver=false; paused=false; shrinkEffectStart=null; flashIsShrinkDot=false;
      lastMoveMs=millis(); particles=[]; scoreAnimations=[];
      spawnFood(); updateHUD(); loop();
    }

    function updateHUD(){
      document.getElementById('score').innerText = score;
      document.getElementById('high-score').innerText = highScore;
    }

    function drawGridAndBorder(now){
      const C=themeColors();
      background(C.CANVAS_BG);
      strokeWeight(2);
      for(let y=0;y<GRID_SIZE;y++){
        for(let x=0;x<GRID_SIZE;x++){
          stroke(C.BORDER_COLOR); noFill();
          rect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }
      }
      if(flashStartTime){
        const elapsed = now - flashStartTime;
        const t = constrain(elapsed/FLASH_DURATION,0,1);
        if(t>=1){flashStartTime=null; flashIsShrinkDot=false;}
        let flashColor;
        if(flashIsShrinkDot){
          push(); colorMode(HSB,360,100,100);
          const hue=((now/1000)*360)%360;
          flashColor = lerpColor(color(hue,100,100), color(C.BORDER_COLOR), t);
          pop();
        }else{
          flashColor = lerpColor(color(C.FOOD_COLOR), color(C.BORDER_COLOR), t);
        }
        stroke(flashColor);
      }else{
        stroke(themeColors().BORDER_COLOR);
      }
      strokeWeight(4); noFill(); rect(0,0,width,height,16);
    }

    function createParticles(gx,gy,count,isRainbow){
      const C=themeColors();
      for(let i=0;i<count;i++){
        let c;
        if(isRainbow){ colorMode(HSB,360,100,100); c=color(random(360),100,100); colorMode(RGB,255); }
        else{ c=color(C.FOOD_COLOR); }
        let life=random(30,60);
        particles.push({ x:gx*TILE_SIZE+TILE_SIZE/2, y:gy*TILE_SIZE+TILE_SIZE/2,
          vx:random(-4,4), vy:random(-4,4), life, maxLife:life, color:c });
      }
    }

    function draw(){
      const now=millis(), C=themeColors();

      if(speedBoostEndTime && now>speedBoostEndTime){ setSnakeSpeed(min(movesPerSec-2,9)); speedBoostEndTime=null; }

      drawGridAndBorder(now);

      if(!gameStarted){
        textSize(18); fill(C.TEXT); textAlign(CENTER,CENTER);
        text('Press Any Key To Start', width/2, height/2); return;
      }

      noStroke(); fill(C.FOOD_COLOR);
      ellipse(food.x*TILE_SIZE+TILE_SIZE/2, food.y*TILE_SIZE+TILE_SIZE/2, TILE_SIZE*0.6);

      if(shrinkDot){
        noStroke(); colorMode(HSB,360,100,100,100);
        const pulse=0.5+0.5*sin(millis()/300), maxGlow=TILE_SIZE*0.8, steps=4;
        for(let i=steps;i>=1;i--){
          const r=(TILE_SIZE*0.5+(maxGlow*pulse*i)/steps)/2, a=50*(1-i/steps), hue=((millis()/1000)*360+i*20)%360;
          fill(hue,100,100,a);
          ellipse(shrinkDot.x*TILE_SIZE+TILE_SIZE/2, shrinkDot.y*TILE_SIZE+TILE_SIZE/2, r*2);
        }
        const mainHue=((millis()/1000)*360)%360;
        fill(mainHue,100,100,100);
        ellipse(shrinkDot.x*TILE_SIZE+TILE_SIZE/2, shrinkDot.y*TILE_SIZE+TILE_SIZE/2, TILE_SIZE*0.5);
        colorMode(RGB,255);
      }

      if(speedDot){
        noStroke(); fill(C.SPEED_DOT_COLOR);
        ellipse(speedDot.x*TILE_SIZE+TILE_SIZE/2, speedDot.y*TILE_SIZE+TILE_SIZE/2, TILE_SIZE*0.5);
      }

      const colStart=color(C.GRAD_START), colEnd=color(C.GRAD_END);
      for(let i=0;i<snake.length;i++){
        const cur=snake[i], prev=prevSnake[i]||cur;
        const xPx=lerp(prev.x,cur.x, paused?0:constrain((now-lastMoveMs)/MOVE_INTERVAL,0,1))*TILE_SIZE;
        const yPx=lerp(prev.y,cur.y, paused?0:constrain((now-lastMoveMs)/MOVE_INTERVAL,0,1))*TILE_SIZE;
        const ratio=snake.length===1?0:i/(snake.length-1);

        if(shrinkEffectStart && i>=snake.length-2 && i<snake.length && snake.length>1){
          const elapsed=now-shrinkEffectStart, t=constrain(elapsed/SHRINK_EFFECT_DURATION,0,1);
          if(t>=1) shrinkEffectStart=null;
          const flash=sin(millis()/50)*0.5+0.5, scale=lerp(1,0.5,t);

          push(); colorMode(HSB,360,100,100,100); noFill();
          const pulse=0.5+0.5*sin(millis()/300), maxSize=TILE_SIZE*1.2, steps=4;
          for(let j=steps;j>=1;j--){
            const size=TILE_SIZE*scale+(maxSize*pulse*j)/steps, a=60*(1-j/steps), hue=((millis()/1000)*360+j*20)%360;
            stroke(hue,100,100,a); strokeWeight(3);
            rect(xPx+(TILE_SIZE-size)/2, yPx+(TILE_SIZE-size)/2, size, size);
          }
          pop();

          fill(lerpColor(color(255), lerpColor(colStart,colEnd,ratio), flash));
          rect(xPx+(TILE_SIZE*(1-scale))/2, yPx+(TILE_SIZE*(1-scale))/2, TILE_SIZE*scale, TILE_SIZE*scale);
        }else{
          fill(lerpColor(colStart,colEnd,ratio)); rect(xPx,yPx,TILE_SIZE,TILE_SIZE);
        }
      }

      for(let i=particles.length-1;i>=0;i--){
        let p=particles[i], alpha=map(p.life,0,p.maxLife,0,200), size=map(p.life,0,p.maxLife,2,6);
        fill(red(p.color),green(p.color),blue(p.color),alpha); noStroke(); ellipse(p.x,p.y,size);
        if(!paused){ p.x+=p.vx; p.y+=p.vy; p.life-=1; if(p.life<=0) particles.splice(i,1); }
      }

      scoreAnimations.forEach((anim,i)=>{
        let alpha=map(anim.life,0,anim.maxLife,0,255);
        fill(themeColors().TEXT); textSize(14); textAlign(CENTER,CENTER);
        text(anim.text, anim.x, anim.y - anim.life*0.5);
        if(!paused){ anim.life-=1; if(anim.life<=0) scoreAnimations.splice(i,1); }
      });

      if(paused){
        textSize(18); fill(themeColors().TEXT); textAlign(CENTER,CENTER);
        text('Paused\nPress Space To Resume', width/2,height/2);
      }

      if(gameOver){
        textSize(18); fill(themeColors().TEXT); textAlign(CENTER,CENTER);
        text('Game Over\nPress Any Key To Restart', width/2,height/2);
        noLoop();
      }

      if(paused) return;

      const elapsed = now - lastMoveMs;
      if(!gameOver && elapsed >= MOVE_INTERVAL){
        prevSnake = snake.map(s=>({...s}));
        const head={x:snake[0].x+direction.x, y:snake[0].y+direction.y};
        const hitWall=head.x<0||head.x>=GRID_SIZE||head.y<0||head.y>=GRID_SIZE;
        const hitSelf=snake.some(s=>s.x===head.x && s.y===head.y);
        if(hitWall||hitSelf){ gameOver=true; }
        else{
          snake.unshift(head);
          if(head.x===food.x && head.y===food.y){
            flashStartTime=now; flashIsShrinkDot=false; score++;
            if(score>highScore){ highScore=score; localStorage.setItem('snakeHighScore', highScore); }
            updateHUD();
            createParticles(head.x,head.y,10,false);
            scoreAnimations.push({x:head.x*TILE_SIZE+TILE_SIZE/2,y:head.y*TILE_SIZE+TILE_SIZE/2,text:'+1',life:60,maxLife:60});
            if(score%2===0 && score<=20) setSnakeSpeed(movesPerSec+SPEED_INCREASE_PER_TWO_SCORES);
            if(score>=2 && random()<0.3){ if(random()<0.5) shrinkDot=spawnSpecialDot('shrink'); else speedDot=spawnSpecialDot('speed'); }
            spawnFood();
          }else{
            snake.pop();
            if(shrinkDot && head.x===shrinkDot.x && head.y===shrinkDot.y){
              if(snake.length>3){
                const tail1={...snake[snake.length-1]}, tail2={...snake[snake.length-2]};
                snake.splice(-2,2); score=max(0,score-2); updateHUD();
                shrinkEffectStart=now; flashStartTime=now; flashIsShrinkDot=true;
                createParticles(head.x,head.y,10,true);
                createParticles(tail1.x,tail1.y,8,true);
                createParticles(tail2.x,tail2.y,8,true);
                scoreAnimations.push({x:head.x*TILE_SIZE+TILE_SIZE/2,y:head.y*TILE_SIZE+TILE_SIZE/2,text:'-2',life:60,maxLife:60});
              }
              shrinkDot=null;
            }
            if(speedDot && head.x===speedDot.x && head.y===speedDot.y){
              setSnakeSpeed(movesPerSec+2); speedBoostEndTime=now+SPEED_BOOST_DURATION;
              flashStartTime=now; flashIsShrinkDot=false;
              createParticles(head.x,head.y,10,false);
              scoreAnimations.push({x:head.x*TILE_SIZE+TILE_SIZE/2,y:head.y*TILE_SIZE+TILE_SIZE/2,text:'Speed Up!',life:60,maxLife:60});
              speedDot=null;
            }
          }
        }
        lastMoveMs=now;
      }
    }

    function keyPressed(){
      if(!gameStarted){ gameStarted=true; startFreshGame(); return; }
      if(gameOver){ startFreshGame(); gameStarted=true; return; }
      if(key===' '){ paused=!paused; if(!paused) loop(); return; }
      const {x,y}=direction;
      if((keyCode===LEFT_ARROW || key==='a' || key==='A') && x!==1)  direction={x:-1,y:0};
      if((keyCode===RIGHT_ARROW|| key==='d' || key==='D') && x!==-1) direction={x:1,y:0};
      if((keyCode===UP_ARROW   || key==='w' || key==='W') && y!==1)  direction={x:0,y:-1};
      if((keyCode===DOWN_ARROW || key==='s' || key==='S') && y!==-1) direction={x:0,y:1};
    }

    function spawnFood(){
      do{ food={x:floor(random(GRID_SIZE)), y:floor(random(GRID_SIZE))}; }
      while(snake.some(s=>s.x===food.x && s.y===food.y));
    }

    function spawnSpecialDot(type){
      let dot;
      do{
        dot={x:floor(random(GRID_SIZE)), y:floor(random(GRID_SIZE))};
      }while(
        snake.some(s=>s.x===dot.x && s.y===dot.y) ||
        (food && food.x===dot.x && food.y===dot.y) ||
        (type==='shrink' && speedDot && speedDot.x===dot.x && speedDot.y===dot.y) ||
        (type==='speed'  && shrinkDot && shrinkDot.x===dot.x && shrinkDot.y===dot.y) /* 修正 */
      );
      return dot;
    }

    // 初始化 HUD
    document.getElementById('high-score').textContent = +localStorage.getItem('snakeHighScore') || 0;
  </script>
</body>
</html>
