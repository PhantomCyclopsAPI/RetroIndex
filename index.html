<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Play Snake and Gomoku online. Minimal gradient style with smooth animations and dark mode."/>
  <title>Retro Index</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Montserrat',sans-serif; }
    body{
      /* 冷灰蓝：#0f1c24 → #324450 */
      background:linear-gradient(180deg,#0f1c24 0%,#324450 100%);
      color:#d8e9f0; overflow-x:hidden;
      transition:background .5s ease,color .5s ease; animation:fadeIn 1.5s ease-in-out;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    nav{
      background:transparent; position:sticky; top:0; z-index:100;
      padding:20px; display:flex; justify-content:center; align-items:center;
      transition:background .3s ease,padding .3s ease;
    }
    /* 冷色半透明顶栏 */
    nav.scrolled{background:rgba(10,20,28,.6); backdrop-filter:blur(10px); padding:10px 20px;}
    nav ul{display:flex; list-style:none; gap:32px;}
    nav a{color:inherit; text-decoration:none; font-size:16px; font-weight:500; position:relative;}
    nav a::after{
      content:''; position:absolute; bottom:-4px; left:0; width:0; height:2px;
      /* 霓虹青 → 冷淡蓝紫 */
      background:linear-gradient(90deg,#00e0ff,#9caedb); transition:width .3s ease;
    }
    nav a:hover::after{width:100%}
    #theme-toggle{
      /* 霓虹青按钮 */
      background:linear-gradient(135deg,#00e0ff,#9caedb); color:#0a1a22; border:none;
      padding:8px 16px; border-radius:50px; cursor:pointer; font-size:14px; margin-left:32px;
      transition:transform .3s ease, box-shadow .3s ease;
    }
    #theme-toggle:hover{transform:scale(1.05); box-shadow:0 4px 12px rgba(0,224,255,.35)}

    .hero{
      text-align:center; padding:80px 20px;
      /* 冷灰蓝背景 */
      background:linear-gradient(135deg,#0f1c24 0%,#324450 100%);
      color:#d8e9f0; margin-bottom:60px; border-radius:0 0 32px 32px;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .hero h1{
      font-size:42px; font-weight:700; margin-bottom:12px; font-family:'Exo',sans-serif;
      /* 霓虹青标题渐变 */
      background:linear-gradient(90deg,#00e0ff,#9caedb);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .hero p{font-size:18px; max-width:500px; margin:0 auto; opacity:.9}

    .game-grid{
      display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:40px; max-width:1000px; margin:0 auto; padding:40px 20px;
    }
    .game-card{
      /* 冷主题卡片：深蓝灰半透明 */
      background:rgba(10,20,28,.55); border-radius:24px; overflow:hidden;
      box-shadow:0 12px 32px rgba(0,224,255,.14);
      transition:transform .4s ease, box-shadow .4s ease, opacity .6s ease-out;
      text-align:center; padding:24px; opacity:0; transform:translateY(30px);
    }
    .game-card.visible{opacity:1; transform:translateY(0)}
    .game-card:hover{transform:translateY(-12px) scale(1.03); box-shadow:0 16px 48px rgba(0,224,255,.22)}

    .thumbnail-canvas{
      width:160px; height:160px; margin:0 auto 20px; border-radius:16px; overflow:hidden;
      box-shadow:0 4px 12px rgba(0,0,0,.25); transition:transform .4s ease, box-shadow .4s ease;
    }
    .game-card.visible .thumbnail-canvas{transform:scale(1.05); box-shadow:0 8px 24px rgba(0,224,255,.18)}
    .thumbnail-canvas canvas{width:100% !important; height:100% !important; display:block;}

    .game-card h2{font-size:24px; font-weight:700; margin-bottom:8px; font-family:'Exo',sans-serif;}
    .game-card p{font-size:14px; color:#b8c7d6; margin-bottom:16px;}
    .game-card a{
      display:inline-block; background:linear-gradient(135deg,#00c6ff,#0072ff);
      color:#07161d; padding:10px 24px; border-radius:50px; text-decoration:none; font-weight:500;
      transition:transform .3s ease, box-shadow .3s ease;
    }
    .game-card a:hover{transform:scale(1.05); box-shadow:0 4px 12px rgba(0,198,255,.35)}

    /* Dark theme → 暖橙沙尘 */
    body.dark-theme{
      background:linear-gradient(180deg,#2a1400 0%,#b64b00 100%);
      color:#fff2e2;
    }
    body.dark-theme nav.scrolled{background:rgba(26,12,0,.6); backdrop-filter:blur(10px)}
    body.dark-theme nav a::after{
      background:linear-gradient(90deg,#ff7a00,#ffd28a); box-shadow:0 0 5px rgba(255,122,0,.8)
    }
    body.dark-theme #theme-toggle{
      background:linear-gradient(135deg,#ff7a00,#ffd28a); box-shadow:0 0 8px rgba(255,122,0,.55); color:#2a1400;
    }
    body.dark-theme #theme-toggle:hover{box-shadow:0 0 12px rgba(255,122,0,.75)}
    body.dark-theme .hero{
      background:linear-gradient(135deg,#2a1400 0%,#b64b00 100%); box-shadow:0 8px 24px rgba(255,122,0,.15)
    }
    body.dark-theme .hero h1{
      background:linear-gradient(90deg,#ff7a00,#ffd28a);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    body.dark-theme .game-card{
      background:rgba(56,24,0,.55); box-shadow:0 12px 32px rgba(255,122,0,.20)
    }
    body.dark-theme .game-card:hover{box-shadow:0 16px 48px rgba(255,122,0,.30)}
    body.dark-theme .game-card.visible .thumbnail-canvas{box-shadow:0 8px 24px rgba(255,122,0,.25)}
    body.dark-theme .game-card p{color:#ffe3c7}
    body.dark-theme .game-card a{
      background:linear-gradient(135deg,#ff7a00,#ffb347); box-shadow:0 0 8px rgba(255,122,0,.35); color:#2a1400;
    }
    body.dark-theme .game-card a:hover{box-shadow:0 0 12px rgba(255,122,0,.5)}

    @media (max-width:768px){
      .hero{padding:60px 20px}
      .hero h1{font-size:32px}
      .hero p{font-size:16px}
      nav ul{gap:20px; flex-wrap:wrap; justify-content:center}
      nav a{font-size:14px}
      #theme-toggle{margin-left:0; margin-top:12px}
      .game-grid{grid-template-columns:1fr; gap:32px; padding:20px}
      .thumbnail-canvas{width:140px; height:140px}
    }
    @media (prefers-reduced-motion:reduce){
      .game-card,.thumbnail-canvas,.game-card a,#theme-toggle,nav{transition:none}
      .game-card.visible{transform:none; opacity:1}
      .game-card.visible .thumbnail-canvas{transform:none}
      nav.scrolled{transition:none}
    }
  </style>
</head>
<body>
  <nav role="navigation">
    <ul>
      <li><a href="/index.html">Home</a></li>
      <li><a href="/Games/snake.html">Snake</a></li>
      <li><a href="/Games/Gomoku.html">Gomoku</a></li>
    </ul>
    <button id="theme-toggle" aria-label="Toggle theme" aria-pressed="false">Toggle Theme</button>
  </nav>

  <section class="hero">
    <h1>Retro Index</h1>
    <p>Discover classic games reimagined in a modern light.</p>
  </section>

  <main class="game-grid" aria-label="Game list">
    <article class="game-card" style="--card-index:0">
      <div class="thumbnail-canvas" id="snake-canvas"></div>
      <h2>Snake</h2>
      <p>Minimal gradient blocks.</p>
      <a href="/Games/snake.html" aria-label="Play Snake on Retro Index">Play</a>
    </article>

    <article class="game-card" style="--card-index:1">
      <div class="thumbnail-canvas" id="gomoku-canvas"></div>
      <h2>Gomoku</h2>
      <p>Connect five in a row.</p>
      <a href="/Games/Gomoku.html" aria-label="Play Gomoku on Retro Index">Play</a>
    </article>
  </main>

  <script>
    // ---------- Theme ----------
    const THEME_KEY='retroIndexTheme';
    function applyTheme(t){
      const dark=t==='dark';
      document.body.classList.toggle('dark-theme',dark);
      document.getElementById('theme-toggle').setAttribute('aria-pressed',String(dark));
    }
    (function(){
      const saved=localStorage.getItem(THEME_KEY);
      const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(saved || (prefersDark?'dark':'light'));
    })();
    document.getElementById('theme-toggle').addEventListener('click',()=>{
      const dark=!document.body.classList.contains('dark-theme');
      applyTheme(dark?'dark':'light');
      localStorage.setItem(THEME_KEY,dark?'dark':'light');
      window.__redrawThumbnails && window.__redrawThumbnails();
    });

    // ---------- Nav scroll ----------
    let ticking=false;
    window.addEventListener('scroll',()=>{
      if(!ticking){
        window.requestAnimationFrame(()=>{
          const nav=document.querySelector('nav');
          if(window.scrollY>100) nav.classList.add('scrolled'); else nav.classList.remove('scrolled');
          ticking=false;
        }); ticking=true;
      }
    });

    // ---------- Card reveal ----------
    const observer=new IntersectionObserver(entries=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); observer.unobserve(e.target);} });
    },{threshold:0.2});
    document.querySelectorAll('.game-card').forEach(card=>observer.observe(card));

    // ---------- p5 helpers ----------
    const currentTheme=()=>document.body.classList.contains('dark-theme')?'dark':'light';

    // ===== Snake（仅改颜色）=====
    const snakeSketch=(p)=>{
      const TILE=20, W=160, H=160, COLS=W/TILE|0, ROWS=H/TILE|0;
      const X0=1, X1=6, Y0=1, Y1=6;

      function makeRoute(){
        const r=[];
        for(let y=Y0;y<=Y1;y++){
          if((y-Y0)%2===0){ for(let x=X0;x<=X1;x++) r.push({x,y}); }
          else{ for(let x=X1;x>=X0;x--) r.push({x,y}); }
        }
        for(let y=Y1-1;y>=Y0;y--) r.push({x:X0,y});
        return r;
      }
      const ROUTE=makeRoute(), RLEN=ROUTE.length;

      function posOnRoute(u){
        const uWrap=((u%RLEN)+RLEN)%RLEN;
        const i=Math.floor(uWrap), t=uWrap-i;
        const a=ROUTE[i], b=ROUTE[(i+1)%RLEN];
        return {x: a.x+(b.x-a.x)*t, y: a.y+(b.y-a.y)*t};
      }

      const SPEED=3.0, SEG_SPACING=0.7; let length=6, uHead=0, lastMillis=0;

      function drawBoard(){
        // 冷/暖背景与网格
        if(currentTheme()==='light'){
          p.background(p.color(15,28,36)); // 冷灰蓝
          p.stroke(p.color(156,174,219,70));
        }else{
          p.background(p.color(42,18,0));  // 暖褐基底
          p.stroke(p.color(255,210,138,70));
        }
        p.strokeWeight(1);
        for(let i=0;i<=COLS;i++) p.line(i*TILE,0,i*TILE,H);
        for(let j=0;j<=ROWS;j++) p.line(0,j*TILE,W,j*TILE);
      }

      function drawFood(){
        const FOOD_AHEAD=4.0;
        const f=posOnRoute(uHead+FOOD_AHEAD);
        p.noStroke();
        p.fill(currentTheme()==='light' ? '#00e0ff' : '#ff7a00'); // 冷: 霓虹青；暖: 橙
        p.rect(Math.floor(f.x)*TILE+4, Math.floor(f.y)*TILE+4, TILE-8, TILE-8, 4);
      }

      function drawSnake(){
        const GAP=4, R=3;
        const head = currentTheme()==='light' ? p.color(0,224,255) : p.color(255,122,0); // 头色
        const tail = p.lerpColor(head, p.color(255,255,255), 0.55);

        p.noStroke();
        for(let i=length-1;i>=0;i--){
          const u = uHead - i*SEG_SPACING;
          const pos = posOnRoute(u);
          const gx=Math.round(pos.x), gy=Math.round(pos.y);
          const x=gx*TILE + GAP/2, y=gy*TILE + GAP/2, w=TILE-GAP, h=TILE-GAP;
          const t = p.constrain(1 - i/(length-1 || 1), 0, 1);
          const col = p.lerpColor(tail, head, t);
          p.fill(col); p.rect(x, y, w, h, R);
        }
      }

      p.setup=()=>{ p.createCanvas(W,H); p.pixelDensity(window.devicePixelRatio||1); p.frameRate(60); lastMillis=p.millis(); };
      p.draw=()=>{
        const now=p.millis();
        const dt=Math.min(.05, Math.max(0,(now-lastMillis)/1000)); lastMillis=now;
        uHead += SPEED*dt;
        drawBoard(); drawFood(); drawSnake();
      };
      p.redrawOnce=()=>{ drawBoard(); drawFood(); drawSnake(); };
    };

    // ===== Gomoku（仅改颜色）=====
    const gomokuSketch=(p)=>{
      const SIZE=160, PAD=16, GRID=9;
      const step=(SIZE-PAD*2)/(GRID-1);
      const stones=[[2,2,'black'],[3,3,'white'],[4,4,'black'],[5,5,'white'],[6,6,'black']];
      let lastIdx=0;

      p.setup=()=>{ p.createCanvas(SIZE,SIZE); p.pixelDensity(window.devicePixelRatio||1); p.frameRate(60); };

      function boardColors(){
        if(currentTheme()==='light'){
          // 冷灰蓝棋盘
          return {
            bg1:p.color(15,28,36), bg2:p.color(50,68,80),
            grid:p.color(156,174,219,170),
            glowA:p.color(0,224,255,160), glowB:p.color(156,174,219,110),
            win:p.color(0,224,255,230), blackOutline:p.color(156,174,219,220)
          };
        }else{
          // 暖橙沙尘棋盘
          return {
            bg1:p.color(56,24,0), bg2:p.color(182,75,0),
            grid:p.color(255,210,138,180),
            glowA:p.color(255,122,0,170), glowB:p.color(255,210,138,110),
            win:p.color(255,180,100,230), blackOutline:p.color(255,210,138,220)
          };
        }
      }

      function drawBoard(col){
        p.noStroke();
        for(let y=0;y<SIZE;y++){ const t=y/SIZE; p.fill(p.lerpColor(col.bg1,col.bg2,t)); p.rect(0,y,SIZE,1); }
        p.stroke(col.grid); p.strokeWeight(1);
        for(let i=0;i<GRID;i++){ const x=PAD+i*step, y=PAD+i*step; p.line(PAD,y,SIZE-PAD,y); p.line(x,PAD,x,SIZE-PAD); }
      }

      function drawStone(gx,gy,color,col,isLast=false,t=0){
        const x=PAD+gx*step, y=PAD+gy*step, r=step*0.42, s=isLast? 0.90+0.10*(0.5+0.5*Math.sin(t*0.015)) : 1.0;
        p.push(); p.translate(x,y); p.scale(s);
        if(isLast){
          p.noFill();
          for(let i=0;i<4;i++){
            const rr=r+6+i*6, a=i===0?120:70-i*15, c=i%2===0? col.glowA:col.glowB;
            c.setAlpha(Math.max(0,a+30*Math.sin(t*0.01))); p.stroke(c); p.strokeWeight(2); p.ellipse(0,0,rr*2,rr*2);
          }
        }
        p.noStroke();
        if(color==='black'){
          p.fill(currentTheme()==='light'? p.color(18,18,18): p.color(28,20,16));
          p.ellipse(0,0,r*2,r*2);
          p.noFill(); p.stroke(col.blackOutline); p.strokeWeight(currentTheme()==='light'?2.0:2.2); p.ellipse(0,0,r*2-1,r*2-1);
        }else{
          p.fill(255); p.ellipse(0,0,r*2,r*2);
          p.noFill(); p.stroke(0,0,0,50); p.strokeWeight(1.6); p.ellipse(0,0,r*2-1,r*2-1);
        }
        p.pop();
      }

      function drawWinLine(col){
        const a=stones[0], b=stones[lastIdx];
        const ax=PAD+a[0]*step, ay=PAD+a[1]*step, bx=PAD+b[0]*step, by=PAD+b[1]*step;
        p.stroke(col.win); p.strokeWeight(4); p.line(ax,ay,bx,by);
      }

      p.draw=()=>{
        const col=boardColors(); p.background(0,0); drawBoard(col);
        const t=p.millis(), period=3600, phase=(t%period)/period; lastIdx=Math.floor(phase*stones.length);
        for(let i=0;i<stones.length;i++){ const isLast=i===lastIdx; const st=Math.max(0,t-i*200); drawStone(stones[i][0],stones[i][1],stones[i][2],col,isLast,st); }
        drawWinLine(col);
      };
      p.redrawOnce=()=>{};
    };

    // 挂载
    const snakeInstance=new p5(snakeSketch,'snake-canvas');
    const gomokuInstance=new p5(gomokuSketch,'gomoku-canvas');

    // 主题切换时的单次重绘
    window.__redrawThumbnails=()=>{
      if(snakeInstance && snakeInstance.redrawOnce) snakeInstance.redrawOnce();
      if(gomokuInstance && gomokuInstance.redrawOnce) gomokuInstance.redrawOnce();
    };

    // 可见性节能
    const snakeContainer=document.getElementById('snake-canvas');
    const snakeIO=new IntersectionObserver(([entry])=>{
      if(!snakeInstance) return;
      if(entry.isIntersecting) snakeInstance.loop(); else snakeInstance.noLoop();
    },{threshold:0.1});
    snakeIO.observe(snakeContainer);
    document.addEventListener('visibilitychange',()=>{
      if(!snakeInstance) return;
      if(document.hidden) snakeInstance.noLoop(); else snakeInstance.loop();
    });
  </script>
</body>
</html>
